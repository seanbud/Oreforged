"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const __1 = require("..");
const mapFacetArrayCached_1 = require("./mapFacetArrayCached");
const mapFacetArrayLightweight_1 = require("./mapFacetArrayLightweight");
describe.each([mapFacetArrayCached_1.mapFacetArrayCached, mapFacetArrayLightweight_1.mapFacetArrayLightweight])('test', (fn) => {
    it('initial value on get', () => {
        const dependencies = [(0, __1.createFacet)({ initialValue: { value: 1 } }), (0, __1.createFacet)({ initialValue: { value: 2 } })];
        const result = fn(dependencies, (a, b) => ({ value: `${a.value}-${b.value}` }), __1.shallowObjectEqualityCheck);
        expect(result.get()).toEqual({ value: '1-2' });
    });
    it('initial value on observe', () => {
        const dependencies = [(0, __1.createFacet)({ initialValue: { value: 1 } }), (0, __1.createFacet)({ initialValue: { value: 2 } })];
        const result = fn(dependencies, (a, b) => ({ value: `${a.value}-${b.value}` }), __1.shallowObjectEqualityCheck);
        const listener = jest.fn();
        result.observe(listener);
        expect(listener).toHaveBeenCalledWith({ value: '1-2' });
        expect(listener).toHaveBeenCalledTimes(1);
    });
    it('equality checks the initial and next value and calls only once', () => {
        const dependencies = [(0, __1.createFacet)({ initialValue: { value: 1 } }), (0, __1.createFacet)({ initialValue: { value: 2 } })];
        const result = fn(dependencies, (a, b) => ({ value: `${a.value}-${b.value}` }), __1.shallowObjectEqualityCheck);
        const listener = jest.fn();
        result.observe(listener);
        expect(listener).toHaveBeenCalledWith({ value: '1-2' });
        expect(listener).toHaveBeenCalledTimes(1);
        listener.mockClear();
        dependencies[0].set({ value: 1 });
        expect(listener).not.toBeCalled();
    });
});
//# sourceMappingURL=mapFacetArray.spec.js.map